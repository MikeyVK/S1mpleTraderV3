{#- tier1_base_code.jinja2 - Base template for code artifacts -#}
{#- Version: 1.4.0 -#}
{#- Purpose: Provides module docstring, imports, class structure, function blocks -#}
{%- extends "tier0_base_artifact.jinja2" -%}

{#-
TEMPLATE_METADATA:
  enforcement: STRICT
  level: format
  validates:
    strict:
      - "^import "
      - "^from "
      - "^class "
      - "^def "
      - "^async def "
  extends: tier0_base_artifact.jinja2
  purpose: "Format base for code artifacts - provides module docstring, imports, and structural blocks"
  version: "1.4.0"
  introspection:
    template_id: tier1_base_code
    tier: 1
    parent: tier0_base_artifact
    variables:
      required:
        - class_name
        - class_docstring
      optional:
        - imports
        - layer
        - dependencies
        - responsibilities
        - module_title
        - module_description
    exports_blocks:
      - module_docstring
      - imports_section
      - class_structure
      - methods

WHITESPACE STRATEGY (Issue #72):
- Block boundaries ({% block %}) produce natural newlines
- Trim ({%- -%}) only for internal content (if/for loops, variable substitution)
- super() MUST be right-trimmed ({{ super() -}}) to prevent extra blank line
- Result: SCAFFOLD directly followed by docstring (no gap), then proper spacing
-#}

{%- block content %}
{{ super() }}
{% block module_docstring %}
"""
{% if module_title -%}
{{ module_title }}.
{% else -%}
{{ class_name }} module.
{% endif %}
{% if module_description %}

{{ module_description }}
{% endif %}
{% if layer %}

@layer: {{ layer }}
{% endif -%}
{% if dependencies %}
@dependencies: [{{ dependencies | join(', ') }}]
{% endif -%}
{% if responsibilities %}
@responsibilities:
{% for responsibility in responsibilities -%}
    - {{ responsibility }}
{% endfor -%}
{% endif -%}
"""
{% endblock %}

{% block imports_section %}
{%- if imports and (imports.stdlib or imports.third_party or imports.project) %}
# Standard library
{%- if imports and imports.stdlib %}
{%- for imp in imports.stdlib %}
{{ imp }}
{%- endfor %}
{%- endif %}

# Third-party
{%- if imports and imports.third_party %}
{%- for imp in imports.third_party %}
{{ imp }}
{%- endfor %}
{%- endif %}

# Project modules
{%- if imports and imports.project %}
{%- for imp in imports.project %}
{{ imp }}
{%- endfor %}
{%- endif %}
{%- endif %}
{% endblock %}

{% block class_structure %}
class {{ class_name }}:
    """{{ class_docstring }}"""
{% block methods %}
    pass
{% endblock %}
{% endblock %}
{% endblock %}
