{#- concrete/design.md.jinja2 - Design Document -#}
{#- Version: 2.1.0 -#}
{#- Purpose: Generate design documents with Context/Options/Decision structure -#}
{%- extends "tier2_base_markdown.jinja2" -%}

{#-
TEMPLATE_METADATA:
  enforcement: GUIDELINE
  level: content
  validates:
    guidelines:
      - "Context & Requirements section with Problem/Requirements/Constraints"
      - "Design Options with pros/cons comparison"
      - "Chosen Design with Decision/Rationale/Key Decisions table"
      - "Optional Open Questions section"
  extends: tier2_base_markdown.jinja2
  purpose: "Concrete template for design documents with full DESIGN_TEMPLATE structure"
  version: "2.1.0"
  changelog:
    - version: "2.1.0"
      date: "2026-01-26"
      changes: "Fixed frontmatter newline handling"
    - version: "2.0.0"
      date: "2026-01-26"
      changes: "Full DESIGN_TEMPLATE structure (Issue #72 Cycle 5)"
    - version: "1.0.0"
      date: "2026-01-25"
      changes: "Initial version with basic structure"
  introspection:
    template_id: design
    tier: concrete
    parent: tier2_base_markdown
    variables:
      required:
        - title
        - problem_statement
        - requirements
        - decision
        - rationale
      optional:
        - constraints
        - options
        - key_decisions
        - open_questions
        - related_issues
-#}

{%- block frontmatter_block %}
---
title: {{ title }}
type: design
created: {{ timestamp | default('YYYY-MM-DD') }}
{% if related_issues -%}
related_issues: {{ related_issues | join(', ') }}
{%- endif %}
---

{% endblock %}

{%- block document_content %}

## 1. Context & Requirements

### Problem Statement

{{ problem_statement }}

### Requirements

{{ requirements }}

### Constraints

{{ constraints | default("None") }}

## 2. Design Options
{% for option in options %}

### Option {{ loop.index }}: {{ option.name }}

{{ option.description }}

**Pros:**
{% for pro in option.pros -%}
- {{ pro }}
{% endfor %}

**Cons:**
{% for con in option.cons -%}
- {{ con }}
{% endfor %}
{%- endfor %}

## 3. Chosen Design

### Decision

{{ decision }}

### Rationale

{{ rationale }}

### Key Decisions

| Decision | Rationale | Trade-offs |
|----------|-----------|------------|
{% for kd in key_decisions -%}
| {{ kd.decision }} | {{ kd.rationale }} | {{ kd.tradeoffs }} |
{% endfor %}
{% if open_questions -%}

## 4. Open Questions
{% for question in open_questions -%}
- {{ question }}
{% endfor -%}
{%- endif -%}
{%- endblock %}
