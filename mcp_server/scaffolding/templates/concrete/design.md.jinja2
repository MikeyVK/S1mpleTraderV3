{#- concrete/design.md.jinja2 - Design Document Template -#}
{#- Version: 3.2.0 -#}
{#- Purpose: DESIGN_TEMPLATE.md implementation - pre-implementation design decisions -#}
{%- extends "tier2_base_markdown.jinja2" -%}

{#-
TEMPLATE_METADATA:
  enforcement: GUIDELINE
  level: content
  validates:
    guidelines:
      - "Section 1: Context & Requirements with numbered subsections (1.1, 1.2, 1.3)"
      - "Section 2: Design Options with numbered alternatives (2.1, 2.2, ...)"
      - "Section 3: Chosen Design with Decision/Rationale/Key Decisions table (2 columns)"
      - "Section 4: Open Questions (optional)"
      - "Section dividers (---) between major sections"
  extends: tier2_base_markdown.jinja2
  purpose: "Concrete template for design documents per DESIGN_TEMPLATE.md"
  version: "3.2.0"
  changelog:
    - version: "3.2.0"
      date: "2026-01-27"
      changes: "Added agent_hints for phase transition workflow integration"
    - version: "3.1.0"
      date: "2026-01-26"
      changes: "Fixed requirements newlines, link definitions order"
    - version: "3.0.0"
      date: "2026-01-26"
      changes: "BREAKING: Aligned with DESIGN_TEMPLATE.md - proper section numbering, removed frontmatter, 2-column Key Decisions"
    - version: "2.2.0"
      date: "2026-01-26"
      changes: "Fixed newline before frontmatter"
    - version: "2.1.0"
      date: "2026-01-26"
      changes: "Fixed frontmatter newline handling"
    - version: "2.0.0"
      date: "2026-01-26"
      changes: "Full DESIGN_TEMPLATE structure (Issue #72 Cycle 5)"
    - version: "1.0.0"
      date: "2026-01-25"
      changes: "Initial version with basic structure"
  introspection:
    template_id: design
    tier: concrete
    parent: tier2_base_markdown
    variables:
      required:
        - title
        - status
        - version
        - created
        - implementation_phase
        - problem_statement
        - requirements_functional
        - requirements_nonfunctional
        - decision
        - rationale
      optional:
        - constraints
        - options
        - key_decisions
        - open_questions
  agent_hints:
    phase: "design"
    purpose: "Document pre-implementation design decisions with clear rationale"
    belongs_here:
      - "Design options comparison (pros/cons analysis)"
      - "Decision rationale explaining WHY an option was chosen"
      - "Key design decisions with trade-off reasoning"
      - "Illustrative code examples (design-level, not production)"
      - "Component structure diagrams (Mermaid)"
      - "Open questions that need resolution before implementation"
    does_not_belong:
      - "Research findings or background investigation ‚Üí research.md"
      - "TDD cycle breakdown or task planning ‚Üí planning.md"
      - "Production implementation code ‚Üí source files (link instead)"
      - "Architectural concepts ‚Üí architecture.md"
      - "API reference documentation ‚Üí reference.md"
    tone: "Decision-focused: compare alternatives, explain trade-offs, justify choices"
    common_pitfalls:
      - "Mixing implementation details with design concepts"
      - "Choosing options without explaining rationale"
      - "Skipping the 'why' behind decisions (always document reasoning)"
      - "Treating design as implementation (this is PRE-implementation)"
      - "Including too much code (use illustrative snippets only)"
    workflow_context:
      - "Status lifecycle: PRELIMINARY ‚Üí APPROVED"
      - "Design must be approved before implementation phase"
      - "Open questions block approval (resolve or defer)"
    related_phases:
      before: "planning.md (defines TDD cycles for this design)"
      after: "implementation (source files + tests)"
      parallel: "architecture.md (if architectural concepts emerge)"
-#}

{#- DESIGN_TEMPLATE.md adds: Created, Implementation Phase to header -#}
{%- block header_fields %}

**Status:** {{ status | default("PRELIMINARY") }}  
**Version:** {{ version | default("1.0") }}  
**Created:** {{ created | default(timestamp[:10]) }}  
**Last Updated:** {{ last_updated | default(timestamp[:10]) }}  
**Implementation Phase:** {{ implementation_phase | default("Phase 1.0 - Design") }}  
{% endblock -%}

{#- DESIGN_TEMPLATE.md content: numbered sections with --- dividers -#}
{%- block document_content -%}

---

## 1. Context & Requirements

### 1.1. Problem Statement

{{ problem_statement }}

### 1.2. Requirements

**Functional:**
{% for req in requirements_functional -%}
- [ ] {{ req }}
{% endfor %}

**Non-Functional:**
{% for req in requirements_nonfunctional -%}
- [ ] {{ req }}
{% endfor %}

### 1.3. Constraints

{% if constraints -%}
{{ constraints }}
{% else -%}
None
{% endif %}

---

## 2. Design Options
{% for option in options %}

### 2.{{ loop.index }}. Option {{ "ABCDEFGHIJ"[loop.index0] }}: {{ option.name }}

{{ option.description }}

**Pros:**
{% for pro in option.pros -%}
- ‚úÖ {{ pro }}
{% endfor %}

**Cons:**
{% for con in option.cons -%}
- ‚ùå {{ con }}
{% endfor %}
{%- endfor %}

---

## 3. Chosen Design

**Decision:** {{ decision }}

**Rationale:** {{ rationale }}

### 3.1. Key Design Decisions

| Decision | Rationale |
|----------|-----------|
{% for kd in key_decisions -%}
| {{ kd.decision }} | {{ kd.rationale }} |
{% endfor %}

{% if open_questions -%}

---

## 4. Open Questions

| Question | Options | Status |
|----------|---------|--------|
{% for question in open_questions -%}
| {{ question }} | - | üî¥ Open |
{% endfor -%}
{%- endif -%}
{%- endblock %}
