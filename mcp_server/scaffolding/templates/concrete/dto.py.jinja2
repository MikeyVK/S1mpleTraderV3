{#- concrete/dto.py.jinja2 - Data Transfer Object (Pydantic BaseModel) -#}
{#- Version: 1.5.0 -#}
{#- Purpose: Generate Pydantic DTOs for data transfer between layers -#}
{%- extends "tier2_base_python.jinja2" -%}

{%- import "tier3_pattern_python_pydantic.jinja2" as pydantic -%}
{%- import "tier3_pattern_python_typed_id.jinja2" as typed_id -%}
{%- import "tier3_pattern_python_logging.jinja2" as p_logging -%}

{#-
TEMPLATE_METADATA:
  enforcement: GUIDELINE
  level: content
  validates:
    guidelines:
      - "Pydantic BaseModel inheritance"
      - "Field definitions with type hints and descriptions"
      - "Self-documenting via json_schema_extra"
      - "Immutable by default (frozen=True optional)"
  extends: tier2_base_python.jinja2
  purpose: "Concrete template for Data Transfer Objects (Pydantic)"
  version: "1.5.0"
  changelog:
    - version: "1.5.0"
      date: "2026-02-01"
      changes: "Refactor DTO to compose Tier 3 pattern macros and set enforcement to GUIDELINE"
    - version: "1.4.0"
      date: "2026-01-27"
      changes: "Make examples REQUIRED for consistent self-documenting DTOs"
    - version: "1.3.0"
      date: "2026-01-27"
      changes: "Add field descriptions and json_schema_extra for self-documentation"
    - version: "1.2.0"
      date: "2026-01-26"
      changes: "Changed enforcement from REQUIRED to ARCHITECTURAL (code patterns)"
    - version: "1.1.0"
      date: "2026-01-25"
      changes: "Initial version"
  introspection:
    template_id: dto
    tier: concrete
    parent: tier2_base_python
    variables:
      required:
        - name
        - frozen (True for immutable DTOs, False for state objects)
        - examples (list of example objects for json_schema_extra)
      optional:
        - description
        - fields (each field must have: name, type, description)
        - validators
        - layer (architectural layer, e.g. "DTOs (Strategy)")
        - dependencies (list of dependencies, defaults to pydantic.BaseModel)
        - responsibilities (list of responsibilities, defaults to data validation)
-#}

{% block module_docstring %}
"""{{ name }} DTO module.

Data Transfer Object for {{ name | lower }}.

@layer: {{ layer | default("Domain") }}
@dependencies: {{ dependencies | join(", ") if dependencies is iterable and dependencies is not string else (dependencies if dependencies else "pydantic.BaseModel") }}
@responsibilities: {{ responsibilities | join(", ") if responsibilities is iterable and responsibilities is not string else (responsibilities if responsibilities else "Data validation, type safety" + (", immutability" if frozen else "")) }}
"""
{% endblock %}

{% block imports_section %}
# Standard library
{{ p_logging.pattern_logging_imports() }}

# Third-party
{{ pydantic.pattern_pydantic_imports() }}

# Project modules
{# Optional: typed-id generator imports for Field(default_factory=...) #}
{% if fields %}
{% for field in fields %}
{% if field.default_factory is defined %}
{{ typed_id.pattern_typed_id_imports(function_name=field.default_factory) }}
{% endif %}
{% endfor %}
{% endif %}

{% endblock %}

{% block class_structure %}
class {{ name }}(BaseModel):
{% block class_docstring %}
    """{{ description | default(name + ' DTO.') }}

    Data Transfer Object for {{ name | lower }}.
    {% if fields %}

    Fields:
{% for field in fields %}
        {{ field.name }}: {{ field.description | default('Field description') }}
{% endfor -%}
    {% endif %}
    """
{% endblock -%}
{% block field_definitions %}
{% if fields -%}
{% for field in fields %}
    {{ field.name }}: {{ field.type }} = Field(
{% if field.default is defined %}
        default={{ field.default }},
{% endif %}
{% if field.default_factory is defined %}
        {{ typed_id.pattern_typed_id_default_factory(function_name=field.default_factory) }},
{% endif %}
        description="{{ field.description | default('Field description') }}"
    )
{% endfor -%}
{% else -%}
    pass
{% endif -%}
{% endblock -%}
{% block config_section %}

    model_config = {
        "frozen": {{ 'True' if frozen else 'False' }},
        "extra": "forbid"{% if examples %},
        "json_schema_extra": {
            "examples": {{ examples | tojson(indent=4) | indent(4, first=False) }}
        }{% endif %}

    }
{% endblock -%}
{% endblock %}
