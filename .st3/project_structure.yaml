# Project Structure Configuration
# Purpose: Define directory structure and file policies
# Used by: DirectoryPolicyResolver for path validation
# Cross-references: artifacts.yaml (validates allowed_artifact_types exist)

directories:
  backend:
    parent: null  # Top-level directory
    description: "Backend application code"
    allowed_artifact_types:
      - dto
      - worker
      - adapter
      - interface
      - service
    allowed_extensions:
      - ".py"
    require_scaffold_for:
      - "**/*.py"  # All Python files in backend must be scaffolded

  backend/dtos:
    parent: backend
    description: "Data Transfer Objects"
    allowed_artifact_types:
      - dto  # Override: Only DTOs allowed in this subdirectory
    # Inherits allowed_extensions from parent (implicit)
    # Inherits require_scaffold_for from parent (cumulative)

  backend/workers:
    parent: backend
    description: "Domain operation workers"
    allowed_artifact_types:
      - worker

  backend/adapters:
    parent: backend
    description: "External system adapters"
    allowed_artifact_types:
      - adapter

  backend/interfaces:
    parent: backend
    description: "Abstract protocol definitions"
    allowed_artifact_types:
      - interface

  backend/services:
    parent: backend
    description: "Orchestration and business logic"
    allowed_artifact_types:
      - service

  mcp_server:
    parent: null
    description: "MCP platform code"
    allowed_artifact_types:
      - tool
      - resource
      - schema
      - generic
    allowed_extensions:
      - ".py"
    require_scaffold_for:
      - "tools/**/*.py"
      - "resources/**/*.py"

  mcp_server/tools:
    parent: mcp_server
    description: "MCP tool implementations"
    allowed_artifact_types:
      - tool

  mcp_server/resources:
    parent: mcp_server
    description: "MCP resource providers"
    allowed_artifact_types:
      - resource

  mcp_server/schemas:
    parent: mcp_server
    description: "Pydantic validation schemas"
    allowed_artifact_types:
      - schema

  tests:
    parent: null
    description: "Test suite root — NO test files here directly"
    allowed_artifact_types: []  # Tests must go in tests/mcp_server/ or tests/backend/
    allowed_extensions:
      - ".py"
    require_scaffold_for: []

  tests/mcp_server:
    parent: tests
    description: "MCP server test suite (default discovery via testpaths in pyproject.toml)"
    allowed_artifact_types:
      - unit_test
      - integration_test
    allowed_extensions:
      - ".py"
    require_scaffold_for: []

  tests/mcp_server/unit:
    parent: tests/mcp_server
    description: "MCP unit tests — no real I/O, no fixtures from tests/backend/"
    allowed_artifact_types:
      - unit_test
    allowed_extensions:
      - ".py"
    require_scaffold_for: []

  tests/mcp_server/integration:
    parent: tests/mcp_server
    description: "MCP integration / E2E tests — marked @integration, excluded from default run"
    allowed_artifact_types:
      - integration_test
    allowed_extensions:
      - ".py"
    require_scaffold_for: []

  tests/backend:
    parent: tests
    description: "Backend unit tests — pure Python, no MCP imports"
    allowed_artifact_types:
      - unit_test
    allowed_extensions:
      - ".py"
    require_scaffold_for: []

  docs:
    parent: null
    description: "Documentation root"
    allowed_artifact_types:
      - research
      - planning
      - design
      - architecture
      - tracking
      - reference
      - generic
    allowed_extensions:
      - ".md"
      - ".rst"
    require_scaffold_for: []

  docs/architecture:
    parent: docs
    description: "System architecture documentation"
    allowed_artifact_types:
      - architecture
      - reference

  docs/development:
    parent: docs
    description: "Development phase documents (research, planning, design)"
    allowed_artifact_types:
      - research
      - planning
      - design
      - tracking

  docs/reference:
    parent: docs
    description: "Reference documentation and guides"
    allowed_artifact_types:
      - reference
      - architecture
      - generic

  docs/reference/mcp:
    parent: docs/reference
    description: "MCP server reference documentation"
    allowed_artifact_types:
      - generic
      - reference

  docs/coding_standards:
    parent: docs
    description: "Coding standards and conventions"
    allowed_artifact_types:
      - reference

  docs/implementation:
    parent: docs
    description: "Implementation tracking documents"
    allowed_artifact_types:
      - tracking
      - reference

  .st3:
    parent: null
    description: "Platform configuration"
    allowed_artifact_types: []
    allowed_extensions:
      - ".yaml"
      - ".yml"
    require_scaffold_for: []

  scripts:
    parent: null
    description: "Utility scripts (no restrictions)"
    allowed_artifact_types: []
    allowed_extensions: []  # All extensions allowed
    require_scaffold_for: []

  proof_of_concepts:
    parent: null
    description: "Experimental code (no restrictions)"
    allowed_artifact_types: []
    allowed_extensions: []
    require_scaffold_for: []
